<metal:main use-macro="load: ../master.pt">

    <metal:content fill-slot="title">Violence and criminality analysis</metal:content>

    <metal:content fill-slot="breadcrumbs">
        <li class="active">Crime Analysis</li>
    </metal:content>

    <metal:content fill-slot="content">

        <div class="row" id="analysis">

            <div class="col-md-2">
                <!-- Categories on the left -->
                <div class="row" id="taxonomy">
                    <!-- Terms grouped by taxonomy -->
                    <div id="load-tax" class="loading"></div>

                </div>

            </div>

            <div class="col-md-8">
                <div class="row">
                    <!-- Map with status on the country -->
                    <div id="load-maps" class="loading"></div>
                    <div id="map_canvas" style="height: 500px; width: 100%;"></div>
                </div>

                <div class="row">
                    <!-- Document list -->
                    <table class="table-bordered" id="status-table" style="display: none;">
                        <thead>
                            <tr>
                                <th style="width: 10%;">Date</th>
                                <th style="width: 5%;">+/-</th>
                                <th style="width: 75%;">Status</th>
                                <th style="width: 10%;">Origin</th>
                            </tr>
                        </thead>
                        <tbody id="status">
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="col-md-2">
                <div class="row">
                    <!-- Tag clouds -->
                    <div id="load-tagcloud" class="loading"></div>
                    <h4>Tagcloud</h4>
                    <div id="tagcloud"></div>
                </div>

                <div class="row">
                    <h4>Most frequent terms</h4>
                    <!-- Terms frequency matrix -->
                    <ul class="list-group">
                      <li class="list-group-item" tal:repeat="elm terms['results']">
                        <span class="badge">${elm['frequency']}</span>
                        ${elm['token']}
                      </li>
                    </ul>
                </div>
            </div>


        </div>

    </metal:content>

    <metal:content fill-slot="javascript">

        <script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?key=${key}&sensor=true&region=BR"></script>
        <script src="${request.static_url('lbsociamgame:static/js/lib/maps.js')}"></script>
        <script src="${request.static_url('lbsociamgame:static/js/lib/analysis.js')}"></script>

        <script type="text/javascript">

            $(function() {

                $(document).ready(function(){

                    $.ajax({
                        type: "GET",
                        url: "${request.route_url('crime_topics')}",
                        data: "",
                        dataType: "json",
                        success: function(topics){
                            $( '#load-tax' ).hide();
                            //var topics = data;

                            // Asynchronously load the template.
                            var html = loadTopics(topics);

                            // Add HTML to taxonomy elm
                            $( '#taxonomy' ).append(html);
                        },
                        error: function(){
                            alert("Entrei no Fail dos t√≥picos");
                        },
                        load: function(){
                            $( '#load-tax' ).show();
                        }
                    });

                    // Load maps
                    //initialize();


                    // Load maps for elements with location
                    $.ajax({
                        type: "GET",
                        url: "${request.route_url('crime_locations')}",
                        data: "",
                        dataType: "json",
                        success: function(result){
                            $( '#load-maps' ).hide();
                            $( '#status-table').show();
                            //var topics = data;

                            // Asynchronously load the maps elements.
                            var markers = statusLocations(result);

                            // Load Map with all markers
                            initialize(markers);

                            // Now load tagclouds
                            loadTagclouds("${request.route_url('crime_hashtags')}");

                        },
                        error: function(){
                            alert("Entrei no Fail dos locations");
                        },
                        load: function(){
                            $( '#load-maps' ).show();
                        }
                    });

                });
            });
        </script>
    </metal:content>

</metal:main>